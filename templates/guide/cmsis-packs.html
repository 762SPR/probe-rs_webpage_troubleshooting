{% extends "guide/layout.html" %}

{% block guide_content %}

<h1 class="guide">CMSIS-Packs</h1>
<h2 class="guide" id="basics">Basics</h2>
<div class="row">
    <div class="col-12">
        <p>
            CMSIS-Packs are an ARM mechanism and loose <a
                href="https://arm-software.github.io/CMSIS_5/Pack/html/cp_Packs.html" targe="_blank">specification</a>
            to distribute documentation, flash algorithms, code samples, HALs, etc for an ARM core.
        </p>
        <p>
            A CMSIS-Pack is supposed to be created by the ARM core manufacturer and can be distributed in decentralized
            fashion via a list of sources. Nevertheless, ARM <a
                href="https://developer.arm.com/tools-and-software/embedded/cmsis/cmsis-search"
                target="_blank">hosts</a> the CMSIS-Packs for pretty much any chip you'd ever want.
        </p>
        <p>
            CMSIS-Packs are ZIP files and contain arbitrary files. The exact structure is manufacturer defined and is
            described in the .pdsc file being placed at the root level of the ZIP file.
            The .pdsc file is a simple XML file containing all the meta information about the Pack.
        </p>
        <p>
            Also inside the Pack - most of the time (they can be absent if the manufacturer chooses so) - are the flash
            algorithms to flash the chips described by the Pack.
            Those are the .FLM files, which are plain old <a
                href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format" targe="_blank">ELF binaries</a>
            adhering to a certain defined structure.
        </p>
    </div>
</div>

<h2 class="guide" id="flash-algorithms">Flash Algorithms</h2>
<h2></h2>
<div class="row">
    <div class="col-12">
        <p>
            A flash algorithm is a simple program that is executed. It consists of a fixed set of (sometimes optional)
            functions which get loaded into RAM and are executed by the flash downloader.
            Those functions are described <a href="https://arm-software.github.io/CMSIS_5/Pack/html/flashAlgorithm.html"
                target="_blank">here</a>. The same specification also describes the metadata that is stored inside the
            ELF binary itself as a debug symbol and inside the .pdsc file.
        </p>
        <p>
            Both, the loadable ELF symbols, as well as the metadata are required to assemble a fully functional flash
            algorithm. This is the job of the flash downloader.
            The functions follow standard ARM EABI calling convention.
        </p>
    </div>
</div>

<h2 class="guide" id="yaml-format">YAML format</h2>
<div class="row">
    <div class="col-12">
        <p>
            Since the Packs are full of bloat we don't need, we have introduced a slimmed down format for target
            description.
            We chose YAML to represent the target as it is a well known format and allows comments.
            Every YAML file adresses an entire family of chips equivalent to the CMSIS-Packs.
        </p>
        <p>
            The yaml format follows the following structure:
            {{ "snippets/yaml.yaml" | code | safe }}
        </p>
    </div>
</div>

<h2 class="guide" id="target-extraction">Target extraction</h2>
<div class="row">
    <div class="col-12">
        <p>
            Since doing all of this by hand would be madness, we provide a utility called <a
                href="https://github.com/probe-rs/target-gen" target="_blank">target-gen</a> which can be used to
            extract a family definition. Including all metadata and the ELF blob.
        </p>
        <p>
            The utility accepts both an unzipped Pack folder as well as the still zipped .pack file.
            To run it, use 'target-gen &lt;pack-file&gt; &lt;output-directory&gt;'.
            The generated file can be loaded as a target by probe-rs.
        </p>
    </div>
</div>

{% endblock %}